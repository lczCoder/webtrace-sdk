!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).WebTraceSdk=t()}(this,(function(){"use strict";const e={100:"未初始化",101:"参数类型错误",102:"参数缺失",103:"重复调用"},t=e=>!!window.localStorage&&(localStorage.getItem(e)||"none"),n=({msg:t,desc:n}={})=>{console.error(`\n     ErrorType: <${e[t]}>,\n     ErrorDesc: ${n}\n  `)},{screen:{width:o,height:i}}=window,r={screenWidth:o,screenHeight:i,browser:(()=>{const e=window.window.navigator.userAgent.toLowerCase(),t={ie:/msie/.test(e)&&!/opera/.test(e),opera:/opera/.test(e),safari:/version.*safari/.test(e),chrome:/chrome/.test(e),firefox:/gecko/.test(e)&&!/webkit/.test(e)};return Object.keys(t).filter((e=>{if(t[e])return e})).join(",")})()||"other",os:(()=>{const e="Win32"==window.navigator.platform||"Windows"==window.navigator.platform,t="Mac68K"==window.navigator.platform||"MacPPC"==window.navigator.platform||"Macintosh"==window.navigator.platform||"MacIntel"==window.navigator.platform,n=String(window.navigator.platform).indexOf("Linux")>-1,o="X11"==window.navigator.platform&&!e&&!t;return e?"window":t?"Mac":o?"Unix":n?"Linux":"other"})()};var a="1.0.3",s="webtrace-sdk",c=a;const d={requestUrl:"",deviceInfo:r,pv:!1,performance:!1,error:!0,debug:!1,catch:!0},l={appid:"",deviceInfo:r,uuid:(()=>{const e=t("Webtrace_UUID");if(e&&"none"!==e)return e;const n=(new Date).getTime()+"",o=Math.floor(100*Math.random()),i=((e=1)=>{let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(Math.floor(26*Math.random())+"a".charCodeAt(0));return t})(3)+"_"+n.substring(8,13)+"_"+o;return"none"==e&&localStorage.setItem("Webtrace_UUID",i),i})(),version:a};var g={init(e){const{options:t={},appId:n,requestUrl:o}=e;d.requestUrl=o,l.appid=n,Object.assign(d,t)}},f={init(){if(!d.error)return!1;window.onerror=function(e){console.log("error1",e)},window.addEventListener("unhandledrejection",(e=>{console.log("error2",e.reason)}))}};const w=!!navigator.sendBeacon;var m={init(){window.document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState&&((e,t)=>{if(w)navigator.sendBeacon(`${d.requestUrl+e}`,JSON.stringify({...l,...t}));else{let n=Object.assign(l,t),o=Object.entries(n).map((([e,t])=>`${e}=${JSON.stringify(t)}`)).join("&");(new Image).src=`${d.requestUrl+e}?${o}`}})("/post",{city:"北京",age:1e3})})),window.onbeforeunload=function(e){}}};const p=new Map;var u={_recordTime(e){if(!p.has(e))return p.set(e,(new Date).getTime()),!1;p.set(`${e}__again__`,!0),n({msg:"103",desc:`timeStart('${e}')已完成初始化,在timeEnd('${e}')触发前,请勿重复调用`})},_dealTime(e){if(p.has(`${e}__again__`))return p.delete(`${e}__again__`),!1;if(!p.has(e))return n({msg:"100",desc:`不存在'${e}'事件的时间初始化方法,如需统计请先调用timeStart('${e}')方法`}),!1;const t=p.get(e),o=(((new Date).getTime()-t)/1e3).toFixed(5);p.delete(e),console.log(`'${e}'事件，一共耗时${o}秒`)}};class h{constructor(e={}){console.log("实例被创建"+(new Date).getTime()),this.init(e)}init(e){g.init(e),f.init(),m.init()}timeStart(e){u._recordTime(e)}timeEnd(e){u._dealTime(e)}}return{name:s,version:c,init:function(e={}){if("[object Object]"!==Object.prototype.toString.call(e))return n({msg:"101",desc:"init()方法需要传入一个配置参数,类型为object"}),!1;{const{appId:t,requestUrl:o,options:i}=e;if(((e,t,o)=>{let i=!0;return e&&t?"string"!=typeof e?(i=!1,n({msg:"101",desc:"init()参数appId类型必须为string类型"}),i):"string"==typeof t&&/http/.test(t)?o&&"[object Object]"!==Object.prototype.toString.call(o)?(i=!1,n({msg:"101",desc:"init()如果配置了options参数,类型必须为object"}),i):i:(i=!1,n({msg:"101",desc:"init()参数requestUrl必须是http地址"}),i):(i=!1,n({msg:"102",desc:"init()参数appId和requestUrl不能为空"}),i)})(t,o,i)){const t=new h(e);window.sdk=t}}}}}));
