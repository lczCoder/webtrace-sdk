"use strict";const e={100:"未初始化",101:"参数类型错误",102:"参数缺失",103:"重复调用"},t=e=>!!window.localStorage&&(localStorage.getItem(e)||"none"),n=({msg:t,desc:n}={})=>{console.error(`\n     ErrorType: <${e[t]}>,\n     ErrorDesc: ${n}\n  `)},{screen:{width:r,height:o}}=window,i={screenWidth:r,screenHeight:o,browser:(()=>{const e=window.window.navigator.userAgent.toLowerCase(),t={ie:/msie/.test(e)&&!/opera/.test(e),opera:/opera/.test(e),safari:/version.*safari/.test(e),chrome:/chrome/.test(e),firefox:/gecko/.test(e)&&!/webkit/.test(e)};return Object.keys(t).filter((e=>{if(t[e])return e})).join(",")})()||"other",os:(()=>{const e="Win32"==window.navigator.platform||"Windows"==window.navigator.platform,t="Mac68K"==window.navigator.platform||"MacPPC"==window.navigator.platform||"Macintosh"==window.navigator.platform||"MacIntel"==window.navigator.platform,n=String(window.navigator.platform).indexOf("Linux")>-1,r="X11"==window.navigator.platform&&!e&&!t;return e?"window":t?"Mac":r?"Unix":n?"Linux":"other"})()};var a="webtrace-sdk",s="1.0.3";const c={requestUrl:"",deviceInfo:i,pv:!1,performance:!1,error:!0,debug:!1,catch:!0},d={appid:"",deviceInfo:i,uuid:(()=>{const e=t("Webtrace_UUID");if(e&&"none"!==e)return e;const n=(new Date).getTime()+"",r=Math.floor(100*Math.random()),o=((e=1)=>{let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(Math.floor(26*Math.random())+"a".charCodeAt(0));return t})(3)+"_"+n.substring(8,13)+"_"+r;return"none"==e&&localStorage.setItem("Webtrace_UUID",o),o})(),version:"1.0.3"};var g={init(e){const{options:t={},appId:n,requestUrl:r}=e;c.requestUrl=r,d.appid=n,Object.assign(c,t)}},l={init(){if(!c.error)return!1;window.onerror=function(e){console.log("error1",e)},window.addEventListener("unhandledrejection",(e=>{console.log("error2",e.reason)}))}};const w=!!navigator.sendBeacon;var m={init(){window.document.addEventListener("visibilitychange",(()=>{"hidden"===document.visibilityState&&((e,t)=>{if(w)navigator.sendBeacon(`${c.requestUrl+e}`,JSON.stringify({...d,...t}));else{let n=Object.assign(d,t),r=Object.entries(n).map((([e,t])=>`${e}=${JSON.stringify(t)}`)).join("&");(new Image).src=`${c.requestUrl+e}?${r}`}})("/post",{city:"北京",age:1e3})})),window.onbeforeunload=function(e){}}};const p=new Map;var f={_recordTime(e){if(!p.has(e))return p.set(e,(new Date).getTime()),!1;p.set(`${e}__again__`,!0),n({msg:"103",desc:`timeStart('${e}')已完成初始化,在timeEnd('${e}')触发前,请勿重复调用`})},_dealTime(e){if(p.has(`${e}__again__`))return p.delete(`${e}__again__`),!1;if(!p.has(e))return n({msg:"100",desc:`不存在'${e}'事件的时间初始化方法,如需统计请先调用timeStart('${e}')方法`}),!1;const t=p.get(e),r=(((new Date).getTime()-t)/1e3).toFixed(5);p.delete(e),console.log(`'${e}'事件，一共耗时${r}秒`)}};class u{constructor(e={}){console.log("实例被创建"+(new Date).getTime()),this.init(e)}init(e){g.init(e),l.init(),m.init()}timeStart(e){f._recordTime(e)}timeEnd(e){f._dealTime(e)}}var h={name:a,version:s,init:function(e={}){if("[object Object]"!==Object.prototype.toString.call(e))return n({msg:"101",desc:"init()方法需要传入一个配置参数,类型为object"}),!1;{const{appId:t,requestUrl:r,options:o}=e;if(((e,t,r)=>{let o=!0;return e&&t?"string"!=typeof e?(o=!1,n({msg:"101",desc:"init()参数appId类型必须为string类型"}),o):"string"==typeof t&&/http/.test(t)?r&&"[object Object]"!==Object.prototype.toString.call(r)?(o=!1,n({msg:"101",desc:"init()如果配置了options参数,类型必须为object"}),o):o:(o=!1,n({msg:"101",desc:"init()参数requestUrl必须是http地址"}),o):(o=!1,n({msg:"102",desc:"init()参数appId和requestUrl不能为空"}),o)})(t,r,o)){const t=new u(e);window.sdk=t}}}};module.exports=h;
