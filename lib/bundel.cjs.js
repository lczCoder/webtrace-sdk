"use strict";const e={100:"未初始化",101:"参数类型错误",102:"参数缺失",103:"重复调用"},t=e=>!!window.localStorage&&(localStorage.getItem(e)||"none"),n=({msg:t,desc:n}={})=>{console.error(`\n     ErrorType: <${e[t]}>,\n     ErrorDesc: ${n}\n  `)},{screen:{width:o,height:r}}=window,i={screenWidth:o,screenHeight:r,browser:(()=>{const e=window.window.navigator.userAgent.toLowerCase(),t={ie:/msie/.test(e)&&!/opera/.test(e),opera:/opera/.test(e),safari:/version.*safari/.test(e),chrome:/chrome/.test(e),firefox:/gecko/.test(e)&&!/webkit/.test(e)};return Object.keys(t).filter((e=>{if(t[e])return e})).join(",")})()||"other",os:(()=>{const e="Win32"==window.navigator.platform||"Windows"==window.navigator.platform,t="Mac68K"==window.navigator.platform||"MacPPC"==window.navigator.platform||"Macintosh"==window.navigator.platform||"MacIntel"==window.navigator.platform,n=String(window.navigator.platform).indexOf("Linux")>-1,o="X11"==window.navigator.platform&&!e&&!t;return e?"window":t?"Mac":o?"Unix":n?"Linux":"other"})()};var s="webtrace-sdk",a="1.0.3";const c={requestUrl:"",deviceInfo:i,pv:!1,performance:!1,error:!0,debug:!1,cache:!0,cacheMax:10};(()=>{const e=t("Webtrace_UUID");if(e&&"none"!==e)return e;const n=(new Date).getTime()+"",o=Math.floor(100*Math.random()),r=((e=1)=>{let t="";for(let n=0;n<e;n++)t+=String.fromCharCode(Math.floor(26*Math.random())+"a".charCodeAt(0));return t})(3)+"_"+n.substring(8,13)+"_"+o;"none"==e&&localStorage.setItem("Webtrace_UUID",r)})();var g={init(e){const{options:t={},appId:n,requestUrl:o}=e;c.requestUrl=o,Object.assign(c,t)}};const d=sessionStorage.getItem("EVENT_QUEUE"),l=d?JSON.parse(d):[],w=new Map;var m={init(){window.document.addEventListener("visibilitychange",(()=>{})),window.onbeforeunload=function(e){}}};const f=(e,t)=>{const n={eventType:"error",url:window.location.href,time:Date.now(),errorInfo:{errorType:e,...t}};var o;o=n,l.push(o),l.length>c.cacheMax&&(l.length=0),sessionStorage.setItem("EVENT_QUEUE",JSON.stringify(l))};var p={init(){if(!c.error)return!1;window.addEventListener("error",(e=>{const t=e.target||e.srcElement;if(t instanceof HTMLElement&&-1!==["LINK","SCRIPT","IMG"].indexOf(t.nodeName))f(t.nodeName.toLowerCase(),Object.assign({},{target:t.outerHTML}));else{const{message:t,filename:n,lineno:o,colno:r,error:i}=e;f("js",Object.assign({},{message:t,filename:n,lineno:o,colno:r,stack:c.debug?i?.stack:null}))}}),!0),window.addEventListener("unhandledrejection",(({reason:e})=>{const t={};if(e instanceof Error){const{message:n,stack:o}=e;Object.assign(t,{message:n,stack:c.debug?o:null})}else Object.assign(t,{reason:e});f("promise",t)}))}};const u=e=>{const t=(new Date).getTime();if(!w.has(e))return n({msg:"100",desc:`不存在'${e}'事件的时间初始化方法,如需统计请先调用timeStart('${e}')方法`}),!1;if(w.has(`${e}__again__`)){w.delete(`${e}__again__`);const n=((e,t)=>{let n=(e=e.toString()).indexOf(".");return e=-1!==n?e.substring(0,t+n+1):e.substring(0),parseFloat(e).toFixed(t)})((t-w.get(e))/1e3,5);w.delete(e),console.log(`'${e}'事件，一共耗时${n}秒`)}};class h{constructor(e={}){console.log("实例被创建"+(new Date).getTime()),this.init(e)}init(e){g.init(e),p.init(),m.init()}timeStart(e){(e=>{if(console.log("1"),!w.has(e))return w.set(e,(new Date).getTime()),!1;w.set(`${e}__again__`,!0),n({msg:"103",desc:`timeStart('${e}')已完成初始化,在timeEnd('${e}')触发前,请勿重复调用`})})(e)}timeEnd(e){u(e)}}var b={name:s,version:a,init:function(e={}){if("[object Object]"!==Object.prototype.toString.call(e))return n({msg:"101",desc:"init()方法需要传入一个配置参数,类型为object"}),!1;{const{appId:t,requestUrl:o,options:r}=e;if(((e,t,o)=>{let r=!0;return e&&t?"string"!=typeof e?(r=!1,n({msg:"101",desc:"init()参数appId类型必须为string类型"}),r):"string"==typeof t&&/http/.test(t)?o&&"[object Object]"!==Object.prototype.toString.call(o)?(r=!1,n({msg:"101",desc:"init()如果配置了options参数,类型必须为object"}),r):r:(r=!1,n({msg:"101",desc:"init()参数requestUrl必须是http地址"}),r):(r=!1,n({msg:"102",desc:"init()参数appId和requestUrl不能为空"}),r)})(t,o,r)){const t=new h(e);window.sdk=t}}}};module.exports=b;
